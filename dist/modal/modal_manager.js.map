{"version":3,"file":"modal_manager.js","sourceRoot":"","sources":["../../src/modal/modal_manager.ts"],"names":[],"mappings":"AAEA,MAAM,OAAO,YAAY;IAKvB;QAHQ,iBAAY,GAA2B,IAAI,CAAC;QAC5C,yBAAoB,GAAuB,IAAI,CAAC;IAEjC,CAAC;IAExB,IAAI,QAAQ;QACV,IAAI,IAAI,CAAC,YAAY;YAAE,OAAO,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC;QAC5D,OAAO,IAAI,CAAC;IACd,CAAC;IAEM,MAAM,CAAC,WAAW;QACvB,IAAI,CAAC,YAAY,CAAC,QAAQ,EAAE;YAC1B,YAAY,CAAC,QAAQ,GAAG,IAAI,YAAY,EAAE,CAAC;SAC5C;QACD,OAAO,YAAY,CAAC,QAAQ,CAAC;IAC/B,CAAC;IAEM,eAAe;QACpB,IAAI,CAAC,IAAI,CAAC,YAAY,EAAE;YACtB,IAAI,CAAC,YAAY,GAAG,QAAQ,CAAC,aAAa,CAAC,mBAAmB,CAAC,CAAC;YAChE,QAAQ,CAAC,IAAI,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SAC9C;IACH,CAAC;IAEM,WAAW,CAChB,GAAW,EACX,aAA0B,EAC1B,IAAI,GAAG,IAAI;QAEX,OAAO,CAAC,GAAG,CAAC,cAAc,EAAE,IAAI,CAAC,CAAC;QAClC,IAAI,IAAI,CAAC,YAAY,EAAE;YACrB,OAAO,CAAC,GAAG,CAAC,oBAAoB,EAAE,IAAI,CAAC,YAAY,CAAC,CAAC;YAErD,yDAAyD;YACzD,IAAI,IAAI,CAAC,oBAAoB,KAAK,aAAa,EAAE;gBAC/C,IAAI,CAAC,SAAS,EAAE,CAAC;gBACjB,OAAO;aACR;YAED,IACE,IAAI,CAAC,oBAAoB;gBACzB,IAAI,CAAC,oBAAoB,KAAK,aAAa,EAC3C;gBACA,4DAA4D;gBAC5D,IAAI,CAAC,oBAAoB,EAAE,CAAC;gBAC5B,IAAI,CAAC,WAAW,EAAE,CAAC;aACpB;YAED,IAAI,CAAC,oBAAoB,GAAG,aAAa,CAAC;YAE1C,IAAI,IAAI,CAAC,YAAY,CAAC,GAAG,KAAK,GAAG,EAAE;gBACjC,IAAI,CAAC,YAAY,CAAC,GAAG,GAAG,GAAG,CAAC;gBAC5B,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,aAAa,CAAC;gBAC9C,IAAI,CAAC,YAAY,CAAC,IAAI,GAAG,gBAAgB,CAAC;gBAC1C,IAAI,CAAC,YAAY,CAAC,OAAO;oBACvB,yEAAyE,CAAC;gBAC5E,IAAI,CAAC,YAAY,CAAC,QAAQ,GAAG,mBAAmB,CAAC;gBACjD,IAAI,CAAC,YAAY,CAAC,OAAO,GAAG,YAAY,CAAC;gBACzC,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,GAAG,CAAC,CAAC;aAChC;YAED,IAAI,IAAI,EAAE;gBACR,IAAI,CAAC,aAAa,EAAE,CAAC;gBACrB,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,KAAK,CAAC;gBACtC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;aACrB;SACF;IACH,CAAC;IAEM,SAAS;QACd,IAAI,IAAI,CAAC,YAAY,EAAE;YACrB,IAAI,CAAC,YAAY,CAAC,WAAW,GAAG,IAAI,CAAC;YACrC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,CAAC;YACrB,IAAI,CAAC,oBAAoB,GAAG,IAAI,CAAC;SAClC;IACH,CAAC;IAEO,aAAa;QACnB,OAAO,CAAC,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,YAAY,EAAE,IAAI,CAAC,oBAAoB,CAAC,CAAC;QAC3E,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,oBAAoB,EAAE;YAClD,MAAM,UAAU,GAAG,IAAI,CAAC,oBAAoB,CAAC,qBAAqB,EAAE,CAAC;YAErE,0DAA0D;YAC1D,IAAI,IAAI,CAAC,YAAY,CAAC,aAAa,EAAE;gBACnC,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;aAChE;YAED,oEAAoE;YACpE,IAAI,CAAC,oBAAoB,CAAC,aAAa,EAAE,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;YAExE,qCAAqC;YACrC,MAAM,UAAU,GACd,IAAI,CAAC,oBAAoB,CAAC,aAAa,EAAE,qBAAqB,EAAE,IAAI;gBAClE,GAAG,EAAE,CAAC;gBACN,IAAI,EAAE,CAAC;aACR,CAAC;YAEJ,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;YAC9C,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,UAAU,CAAC,GAAG,GAAG,UAAU,CAAC,GAAG,IAAI,CAAC;YACrE,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,UAAU,CAAC,IAAI,GAAG,UAAU,CAAC,IAAI,IAAI,CAAC;YACxE,OAAO,CAAC,GAAG,CACT,sBAAsB,EACtB,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,GAAG,EAC3B,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,IAAI,CAC7B,CAAC;SACH;IACH,CAAC;IAEO,QAAQ,CAAC,OAAgB;QAC/B,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,oBAAoB,EAAE;YAClD,IAAI,OAAO,EAAE;gBACX,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,MAAM,GAAG,OAAO,CAAC;gBACjD,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,OAAO,CAAC;aAC1C;iBAAM;gBACL,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;gBAChD,IAAI,CAAC,YAAY,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;aACzC;SACF;IACH,CAAC;IAEO,oBAAoB;QAC1B,IAAI,IAAI,CAAC,oBAAoB,EAAE;YAC7B,IAAI,CAAC,oBAAoB,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;SACjD;IACH,CAAC;IAEO,WAAW;QACjB,IAAI,IAAI,CAAC,YAAY,IAAI,IAAI,CAAC,YAAY,CAAC,aAAa,EAAE;YACxD,IAAI,CAAC,YAAY,CAAC,aAAa,CAAC,WAAW,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;SAChE;IACH,CAAC;CACF","sourcesContent":["import { CaptureEyeModal } from './capture-eye-modal.js';\n\nexport class ModalManager {\n  private static instance: ModalManager;\n  private modalElement: CaptureEyeModal | null = null;\n  private currentButtonElement: HTMLElement | null = null;\n\n  private constructor() {}\n\n  get isHidden() {\n    if (this.modalElement) return this.modalElement.modalHidden;\n    return true;\n  }\n\n  public static getInstance(): ModalManager {\n    if (!ModalManager.instance) {\n      ModalManager.instance = new ModalManager();\n    }\n    return ModalManager.instance;\n  }\n\n  public initializeModal(): void {\n    if (!this.modalElement) {\n      this.modalElement = document.createElement('capture-eye-modal');\n      document.body.appendChild(this.modalElement);\n    }\n  }\n\n  public updateModal(\n    nid: string,\n    buttonElement: HTMLElement,\n    show = true\n  ): void {\n    console.log('update modal', show);\n    if (this.modalElement) {\n      console.log('found modalElement', this.modalElement);\n\n      // If the current button is clicked again, hide the modal\n      if (this.currentButtonElement === buttonElement) {\n        this.hideModal();\n        return;\n      }\n\n      if (\n        this.currentButtonElement &&\n        this.currentButtonElement !== buttonElement\n      ) {\n        // Unfocus the currently focused button and remove the modal\n        this.unfocusCurrentButton();\n        this.removeModal();\n      }\n\n      this.currentButtonElement = buttonElement;\n\n      if (this.modalElement.nid !== nid) {\n        this.modalElement.nid = nid;\n        this.modalElement.creatorName = 'Tori Ferenc';\n        this.modalElement.date = '2023/6/9 14:47';\n        this.modalElement.caption =\n          'Looking inward. Photographer Tori Ferenc on a journey of self-discovery';\n        this.modalElement.platform = 'Capture Dashboard';\n        this.modalElement.license = 'Commercial';\n        console.log('render nid', nid);\n      }\n\n      if (show) {\n        this.positionModal();\n        this.modalElement.modalHidden = false;\n        this.setFocus(true);\n      }\n    }\n  }\n\n  public hideModal(): void {\n    if (this.modalElement) {\n      this.modalElement.modalHidden = true;\n      this.setFocus(false);\n      this.currentButtonElement = null;\n    }\n  }\n\n  private positionModal(): void {\n    console.log('positionModal', this.modalElement, this.currentButtonElement);\n    if (this.modalElement && this.currentButtonElement) {\n      const buttonRect = this.currentButtonElement.getBoundingClientRect();\n\n      // Remove the modal from its previous parent if it has one\n      if (this.modalElement.parentElement) {\n        this.modalElement.parentElement.removeChild(this.modalElement);\n      }\n\n      // Append the modal element to the same parent as the button element\n      this.currentButtonElement.parentElement?.appendChild(this.modalElement);\n\n      // Now calculate the correct position\n      const parentRect =\n        this.currentButtonElement.parentElement?.getBoundingClientRect() || {\n          top: 0,\n          left: 0,\n        };\n\n      this.modalElement.style.position = 'absolute';\n      this.modalElement.style.top = `${buttonRect.top - parentRect.top}px`;\n      this.modalElement.style.left = `${buttonRect.left - parentRect.left}px`;\n      console.log(\n        'Modal positioned at:',\n        this.modalElement.style.top,\n        this.modalElement.style.left\n      );\n    }\n  }\n\n  private setFocus(focused: boolean): void {\n    if (this.modalElement && this.currentButtonElement) {\n      if (focused) {\n        this.currentButtonElement.style.zIndex = '10001';\n        this.modalElement.style.zIndex = '10000';\n      } else {\n        this.currentButtonElement.style.zIndex = '1000';\n        this.modalElement.style.zIndex = '1000';\n      }\n    }\n  }\n\n  private unfocusCurrentButton(): void {\n    if (this.currentButtonElement) {\n      this.currentButtonElement.style.zIndex = '1000';\n    }\n  }\n\n  private removeModal(): void {\n    if (this.modalElement && this.modalElement.parentElement) {\n      this.modalElement.parentElement.removeChild(this.modalElement);\n    }\n  }\n}\n"]}